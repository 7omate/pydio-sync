<script id="job.html" type="text/ng-template">
    <div class="panel" ng-class="{'panel-primary':job.active, 'panel-default':!job.active}" style="clear: both;">
        <div class="panel-heading">
            <a ng-if="job.active" href="#" ng-click="toggleJobActive(job.id)" class="pull-right" style="color: white;"><span class="glyphicon glyphicon-off"></span></a>
            <a ng-if="!job.active" href="#" ng-click="toggleJobActive(job.id)" class="pull-right"><span class="glyphicon glyphicon-off"></span> Enable</a>
            Job {{job.id}}</div>

        <div style="line-height: 1.8em;" class="panel-body">
            <div ng-if="job.state.tasks && job.state.tasks.length">
                <div style="font-size: 12px;font-weight: 700;color: #bbb;text-transform: uppercase;letter-spacing: 1px;">Currently Running
                    <a href="#/logs/{{job.id}}">[More]</a>
                </div>
                Time remaining : {{job.state.global['eta'] | seconds}}s<br>
                Remaining bytes to transfer : {{job.state.global['queue_bytesize'] | bytes:1}}
            </div>
            <div style="font-size: 12px;font-weight: 700;color: #bbb;text-transform: uppercase;letter-spacing: 1px;">Last operation
                <a href="#/logs/{{job.id}}">[More]</a>
            </div>
            <div ng-repeat="event in job.last_events | limitTo:1">
                {{event[1]}} - {{event[2]}} - {{event[3]}}
            </div>

            <div style="margin-top: 15px; margin-bottom: 7px; font-size: 12px;font-weight: 700;color: #bbb;text-transform: uppercase;letter-spacing: 1px;">Parameters
                <a href="#/edit/{{job.id}}/step3">[Edit]</a>
            </div>
            <table class="table">
                <tbody>
                    <tr><td style="width: 25%; text-align: right"><strong>Server</strong></td><td>{{job.server}}</td></tr>
                    <tr><td style="width: 25%;text-align: right"><strong>Workspace</strong></td><td>{{job.workspace}}</td></tr>
                    <tr ng-if="job.remote_folder"><td style="width: 25%;text-align: right"><strong>Workspace folder</strong></td><td>{{job.remote_folder}}</td></tr>
                    <tr><td style="width: 25%;text-align: right"><strong>Local folder</strong></td><td>{{job.directory}}</td></tr>
                </tbody>
            </table>
        </div>


        <div class="panel-footer" ng-if="job.active && job.running">
            <span class="pull-right">Status: running <a ng-click="applyCmd('pause', job.id)" style="cursor: pointer;">[Pause]</a></span>&nbsp;
        </div>
        <div class="panel-footer" ng-if="job.active && !job.running">
                <span class="pull-right">Status: paused <a ng-click="applyCmd('resume', job.id)" style="cursor: pointer;">[Resume]</a></span>&nbsp;
        </div>
        <div class="panel-footer" ng-if="!job.active">
                <span class="pull-right"><a href="#" ng-click="deleteJob(job.id)"><span class="glyphicon glyphicon-trash"></span> Remove</a></span>&nbsp;
        </div>
    </div>

</script>
<script id="job_2.html" type="text/ng-template">
    <div class="well" style="clear: both;padding: 10px;">
        <table style="width: 100%;">
            <tr>
                <td style="width:90px;">
                    <img src="images/rocket.png" width="80"/>
                </td>
                <td style="vertical-align: top;padding-top: 10px;">
                    <p style="margin-bottom: 2px;">SYNC {{job.label?job.label:job.id}} <a href="#/edit/{{job.id}}/step2" title="Edit parameters"><span style="opacity: 0.5;" class="small glyphicon glyphicon-info-sign"></span></a></p>
                    <div class="small" ng-if="job.state.tasks && job.state.tasks.total">
                        Size : {{job.state.global['queue_bytesize'] | bytes:1}} -
                        Estimated time : {{job.state.global['eta'] | seconds}}s<br>
                        <div class="progress progress-striped active">
                            <div class="progress-bar" role="progressbar" aria-valuenow="{{100*job.state.global.queue_done/job.state.global.queue_length}}" aria-valuemin="0" aria-valuemax="100" style="width: {{100*job.state.global.queue_done/job.state.global.queue_length}}%;"></div>
                        </div>
                    </div>
                    <div class="small" ng-if="(!job.state.tasks || !job.state.tasks.total) && job.last_event">
                        Last synchronization on {{job.last_event[7]}}<br>
                        {{job.last_event[2]}}
                    </div>
                </td>
                <td style="width:100px; font-size: 2em; text-align: right;padding-right: 5px;">
                    <a href ng-click="job.active?applyCmd(job.running?'pause':'resume', job.id):toggleJobActive(job.id)">
                        <span class="glyphicon" ng-class="{'glyphicon-pause':job.active && job.running,'glyphicon-play':!job.active || !job.running}"
                              style="color: white; display: inline-block; padding:5px; border-radius: 200px; background-color: #0079a1"></span>
                    </a>
                </td>
            </tr>
        </table>
    </div>
    <div style="text-align: center;
                background-color: #fafafa;
                width: 21px;
                border-radius: 200px;
                padding: 5px;
                height: 21px;
                font-size: 0.7em;
                margin: 0 auto;
                margin-top: -32px;
                margin-bottom: 11px;
                border-bottom: 1px solid #ddd;
                color: #555;">
        <a title="See logs" href="#/logs/{{job.id}}"><span class="glyphicon glyphicon-chevron-down"></span></a>
    </div>
</script>

<!--
<p style="margin-top: 10px;" class="lead">You have {{(jobs|filter:{active:true}).length}} jobs running. <a class="btn"><span class="glyphicon glyphicon-pause"></span> Pause all</a></p>
-->
<div class="alert alert-danger alert-dismissable" ng-if="error">{{error}}</div>
<div style="margin-top: 15px;"></div>
<ng-include
        onload="job = job_d"
        ng-repeat="job_d in jobs | filter:{active:true} | orderBy:'workspace'"
        src="'job_2.html'"></ng-include>
<ng-include
        onload="job = job_desc"
        ng-repeat="job_desc in jobs | filter:{active:false} | orderBy:'workspace'"
        src="'job_2.html'"></ng-include>

<div class="well" style="text-align: center; padding: 35px;">
    <a href="#/new">
        <span class="glyphicon glyphicon-plus" style="color: white; display: inline-block; padding:5px; border-radius: 200px; background-color: #0079a1"></span>
        Create a new synchronization
    </a>
</div>
